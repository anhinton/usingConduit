<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Ashley Noel Hinton ahin017@aucklanduni.ac.nz" />
  <title>Guide to using conduit</title>
  <style type="text/css">
    div.main { margin: auto; max-width: 800px; }
    code{ white-space: pre-wrap; }
    .ann {color: green; font-style: italic; background-color: silver; border: solid thin}
    .mod {color: red; font-style: italic; background-color: silver; border: solid thin}
  </style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>
<div class="main">
<div id="header">
<h1 class="title">Guide to using <em>conduit</em></h1>

<p class="author">
Ashley Noel Hinton <a href="mailto:ahin017@aucklanduni.ac.nz">ahin017@aucklanduni.ac.nz</a><br/>
</p>

<p class="date">Time-stamp: &lt;2015-03-04 16:54:13 ahin017&gt;</p>
</div>
<div id="TOC">
<ul>
<li><a href="#quick-start-running-a-pipeline">Quick start: running a pipeline</a><ul>
<li><a href="#installing-conduit">Installing <em>conduit</em></a></li>
<li><a href="#reading-a-pipeline-from-an-xml-file">Reading a pipeline from an XML file</a></li>
<li><a href="#run-a-pipeline-in-conduit">Run a pipeline in <em>conduit</em></a></li>
</ul></li>
<li><a href="#modules">Modules</a><ul>
<li><a href="#loading-modules-from-xml">Loading modules from XML</a></li>
<li><a href="#creating-modules">Creating modules</a></li>
<li><a href="#executing-module-scripts">Executing module scripts</a></li>
<li><a href="#saving-modules-as-xml-files">Saving modules as XML files</a></li>
</ul></li>
<li><a href="#pipelines">Pipelines</a><ul>
<li><a href="#loading-pipelines-from-xml">Loading pipelines from XML</a></li>
<li><a href="#creating-pipelines">Creating pipelines</a></li>
<li><a href="#executing-pipeline-components">Executing pipeline components</a></li>
<li><a href="#saving-and-exporting-pipelines-as-xml-files">Saving and exporting pipelines as XML files</a></li>
</ul></li>
<li><a href="#searching-for-files-in-conduit">Searching for files in <em>conduit</em></a></li>
<li><a href="#outputs-in-conduit">Outputs in <em>conduit</em></a></li>
<li><a href="#example-creating-a-pipeline-from-r-scripts">Example: creating a pipeline from R scripts</a><ul>
<li><a href="#r-scripts">R scripts</a></li>
<li><a href="#getting-data-into-conduit-rentallistings-and-suburbids">Getting data into conduit: <code>rentalListings</code> and <code>suburbIDs</code></a></li>
<li><a href="#feeding-inputs-to-a-module-namesuburbs">Feeding inputs to a module: <code>nameSuburbs</code></a></li>
<li><a href="#the-choosesuburbs-module">The <code>chooseSuburbs</code> module</a></li>
<li><a href="#the-last-module-boxplotbysuburb">The last module: <code>boxplotBySuburb</code></a></li>
<li><a href="#creating-pipes">Creating <code>pipe</code>s</a></li>
<li><a href="#creating-the-aucklandrents-pipeline">Creating the <code>aucklandRents</code> pipeline</a></li>
<li><a href="#running-the-aucklandrents-pipeline">Running the <code>aucklandRents</code> pipeline</a></li>
<li><a href="#exporting-the-simplegraph-pipeline-to-xml">Exporting the <code>simpleGraph</code> pipeline to XML</a></li>
</ul></li>
<li><a href="#example-combining-r-and-python-scripts">Example: combining R and python scripts</a></li>
</ul>
</div>
<p>The <em>openapi</em> project is an attempt to make it easier to connect people with data. The <em>openapi</em> architecture uses an XML scheme to describe modules of discrete data analaysis and exploration steps, which can be arranged in pipelines to describe data workflows. Both modules and pipelines can be shared, modified, and rearranged to suit the user's requirements. Modules and pipelines are exected in an <em>openapi</em> glue system. <em>conduit</em> is a prototype glue system which has been written as a package for the R programming environment. More information on the <em>openapi</em> project can be found in the University of Auckland Department of Statistics technical report, <a href="https://www.stat.auckland.ac.nz/~paul/Reports/openapi/introducingOpenapi/introducingOpenapi.html">Introducing OpenAPI</a>.</p>
<h2 id="quick-start-running-a-pipeline">Quick start: running a pipeline</h2>
<h3 id="installing-conduit">Installing <em>conduit</em></h3>
<p><em>conduit</em> is an R package built using R version 3.1.x on a 64-bit Linux machine. It requires the following R packages: <a href="http://www.omegahat.org/RSXML" title="XML: Tools for parsing and generating XML within R and S-Plus"><em>XML</em></a>, <a href="http://bioconductor.org/packages/release/bioc/html/graph.html" title="graph: A package to handle graph data structures"><em>graph</em></a>, <a href="http://bioconductor.org/packages/release/bioc/html/RBGL.html" title="RBGL: An interface to the BOOST graph library"><em>RBGL</em></a>, and <a href="http://www.omegahat.org/RCurl" title="RCurl: General network (HTTP/FTP/...) client interface for R"><em>RCurl</em></a>. The <a href="http://cran.r-project.org/web/packages/devtools/index.html" title="devtools: Tools to make developing R code easier"><em>devtools</em></a> is required to install <em>conduit</em> directly from github. The <a href="http://bioconductor.org/packages/release/bioc/html/Rgraphviz.html" title="Rgraphviz: Provides plotting capabilities for R graph objects"><em>Rgraphviz</em></a> and <a href="http://r-forge.r-project.org/R/?group_id=1272" title="gridGraphviz: Drawing Graphs with Grid"><em>gridGraphviz</em></a> packages are required to run the modules in this quick start example.</p>
<p>Version 0.1-1 of the <em>conduit</em>, built 2015-02-08, is <a href="conduit_0.1-1.tar.gz">available for download</a>.</p>
<p>Source code for <em>conduit</em> is available at <a href="https://github.com/anhinton/conduit" class="uri">https://github.com/anhinton/conduit</a> for those who would like to build and install the package manually.</p>
<p>To install <em>conduit</em> using <em>devtools</em>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
devtools::<span class="kw">install_github</span>(<span class="st">&quot;anhinton/conduit&quot;</span>)</code></pre>
<p>Load the <em>conduit</em> package:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(conduit)</code></pre>
<h3 id="reading-a-pipeline-from-an-xml-file">Reading a pipeline from an XML file</h3>
<p>The <code>loadPipeline()</code> function is used to read a pipeline XML file into <em>conduit</em>. <code>loadPipeline()</code> requires a <code>name</code> argument, and a <code>ref</code> argument which describes the XML file location The function returns a <code>pipeline</code> object.</p>
<p>We will load a pipeline which creates and plots a simple node-and-edge graph. oThe pipeline XML file is in a sub-directory of the R working directory called 'simpleGraph'.</p>
<pre class="sourceCode r"><code class="sourceCode r">## load the simpleGraph pipeline
simpleGraph &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">loadPipeline</span>(<span class="dt">name =</span> <span class="st">&quot;simpleGraph&quot;</span>, 
                 <span class="dt">ref =</span> <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))</code></pre>
<p>According to its <code>description</code>:</p>
<pre><code>This pipeline creates a directed graphNEL graph, lays it out using the Rgraphviz package, and then plots the graph as a PNG file using the gridGraphviz package</code></pre>
<h3 id="run-a-pipeline-in-conduit">Run a pipeline in <em>conduit</em></h3>
<p>The <code>runPipeline()</code> function is used to run a <code>pipeline</code> object in R. It requires a <code>pipeline</code> object as its only argument. This function will create a directory for the pipeline in the 'pipelines' sub-directory of the current working directory. If a 'pipelines' sub-directory does not exist it will be created. Each module in the pipeline will create output in a named directory found in ./pipelines/PIPELINE_NAME/modules.</p>
<pre class="sourceCode r"><code class="sourceCode r">## run the simpleGraph pipeline
<span class="kw">validatePipeline</span>(simpleGraph)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">conduit:::<span class="kw">graphPipeline</span>(simpleGraph)</code></pre>
<pre><code>## A graphNEL graph with directed edges
## Number of Nodes = 3 
## Number of Edges = 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">runPipeline</span>(simpleGraph)</code></pre>
<p>This creates the following files:</p>
<ol style="list-style-type: decimal">
<li><a href="pipelines/simpleGraph/modules/createGraph/directedGraph.rds" class="uri">pipelines/simpleGraph/modules/createGraph/directedGraph.rds</a></li>
<li><a href="pipelines/simpleGraph/modules/createGraph/script.R" class="uri">pipelines/simpleGraph/modules/createGraph/script.R</a></li>
<li><a href="pipelines/simpleGraph/modules/layoutGraph/Ragraph.rds" class="uri">pipelines/simpleGraph/modules/layoutGraph/Ragraph.rds</a></li>
<li><a href="pipelines/simpleGraph/modules/layoutGraph/script.R" class="uri">pipelines/simpleGraph/modules/layoutGraph/script.R</a></li>
<li><a href="pipelines/simpleGraph/modules/plotGraph/example.png" class="uri">pipelines/simpleGraph/modules/plotGraph/example.png</a></li>
<li><a href="pipelines/simpleGraph/modules/plotGraph/script.R" class="uri">pipelines/simpleGraph/modules/plotGraph/script.R</a></li>
</ol>
<p>File number 5, <a href="pipelines/simpleGraph/modules/plotGraph/example.png" class="uri">pipelines/simpleGraph/modules/plotGraph/example.png</a> is the output file we require, the PNG image of the graph. The image is shown below:</p>
<div class="figure">
<img src="pipelines/simpleGraph/modules/plotGraph/example.png" alt="Pipeline output: PNG image file of graph" />
<p class="caption">Pipeline output: PNG image file of graph</p>
</div>
<hr />
<p>The remainder of this document goes into greater detail about how to create execute <em>openapi</em> <a href="#modules">modules</a> and <a href="#pipelines">pipelines</a> using <em>conduit</em>. Following these is a discussion on <a href="#searching-for-files-in-conduit">how to search for files in <em>conduit</em></a>, and about the <a href="#outputs-in-conduit">outputs produced by <em>conduit</em></a>. To finish there are two fully worked examples: how to create a pipeline containing modules with <a href="#example-creating-a-pipeline-from-r-scripts">R script files for sources</a>, and how to create a pipeline which uses both <a href="#example-combining-r-and-python-scripts">R scripts and python scripts</a>.</p>
<h2 id="modules">Modules</h2>
<p>This sections describes how to: load modules from XML files; create modules; execute module source scripts; save modules as module XML files.</p>
<h3 id="loading-modules-from-xml">Loading modules from XML</h3>
<h4 id="loadmodule"><code>loadModule()</code></h4>
<p>This function reads and interprets a module XML file, producing a <code>module</code> object in R. It requires the following arguments:</p>
<ul>
<li><code>name</code>: module name (must be unique within a pipeline)</li>
<li><code>ref</code>: Filename or file path of xml file.
<ul>
<li><code>path</code>: optional search path(s) for <code>ref</code> resource</li>
</ul></li>
</ul>
<p><code>loadModule()</code> also accepts a <code>namespaces</code> argument, which should be a named character vector of namespaces used in the module XML file. The default value for <code>namespaces</code> is <code>c(oa = &quot;http://www.openapi.org/2014/&quot;))</code>.</p>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">plotGraphXML &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;plotGraph.xml&quot;</span>)
plotGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="dt">name =</span> <span class="st">&quot;plotGraph&quot;</span>,
                        <span class="dt">ref =</span> plotGraphXML)</code></pre>
<h3 id="creating-modules">Creating modules</h3>
<p>Modules can be created in <em>conduit</em> using the <code>module()</code> function and its associated helper functions. The resulting modules can be executed in <em>conduit</em>, or saved to disk as module XML files.</p>
<p>The following example shows how a module can be created.</p>
<pre class="sourceCode r"><code class="sourceCode r">## create input, output, and source lists
inputsList &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">list</span>(<span class="kw">moduleInput</span>(<span class="st">&quot;myGraph&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R </span><span class="ch">\&quot;</span><span class="st">graphNEL</span><span class="ch">\&quot;</span><span class="st"> object&quot;</span>))
outputsList &lt;-
<span class="st">    </span><span class="kw">list</span>(<span class="kw">moduleOutput</span>(<span class="st">&quot;Ragraph&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R </span><span class="ch">\&quot;</span><span class="st">Ragraph</span><span class="ch">\&quot;</span><span class="st"> object&quot;</span>))
sourcesList &lt;-
<span class="st">    </span><span class="kw">list</span>(<span class="kw">moduleSource</span>(<span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;library(Rgraphviz)&quot;</span>, 
                                <span class="st">&quot;Ragraph &lt;- agopen(myGraph, </span><span class="ch">\&quot;</span><span class="st">myGraph</span><span class="ch">\&quot;</span><span class="st">)&quot;</span>)))
## create module
layoutGraph &lt;-<span class="st"> </span><span class="kw">module</span>(<span class="dt">name =</span> <span class="st">&quot;layoutGraph&quot;</span>, <span class="dt">platform =</span> <span class="st">&quot;R&quot;</span>,
                      <span class="dt">description =</span> <span class="st">&quot;Lays out a graphNEL graph using the Rgraphviz package&quot;</span>,
                      <span class="dt">inputs =</span> inputsList,
                      <span class="dt">outputs =</span> outputsList,
                      <span class="dt">sources =</span> sourcesList)</code></pre>
<h4 id="module"><code>module()</code></h4>
<p>The <code>module()</code> function is used to create module objects.</p>
<p>Required aruments:</p>
<ul>
<li><code>name</code>: module name (must be unique within a pipeline)</li>
<li><code>platform</code>: name of platform required to execute module source</li>
</ul>
<p>Optional arguments:</p>
<ul>
<li><code>description</code>: a brief description of what the module does</li>
<li><code>inputs</code>: a list of <a href="#moduleinput"><code>moduleInput</code></a> objects</li>
<li><code>outputs</code>: a list of <a href="#moduleoutput"><code>moduleOutput</code></a> objects</li>
<li><code>sources</code>: a list of <a href="#modulesource"><code>moduleSource</code></a> objects</li>
</ul>
<p>Examples:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">module</span>(<span class="dt">name =</span> <span class="st">&quot;cleanCSV&quot;</span>, <span class="dt">platform =</span> <span class="st">&quot;R&quot;</span>,
               <span class="dt">description =</span> <span class="st">&quot;clean up the data in a CSV file&quot;</span>,
               <span class="dt">inputs =</span> inputsList1, <span class="dt">outputs =</span> outputsList1,
               <span class="dt">sources =</span> sourcesList1)</code></pre>
<h4 id="moduleinput"><code>moduleInput()</code></h4>
<p>The <code>moduleInput()</code> function is used to create the inputs for modules created in R with the <code>module()</code> function. Each input should correspond to an object of the same name in the module's source(s). It requires the following arguments:</p>
<ul>
<li><code>name</code>: input name (must be unique within a module)</li>
<li><code>type</code>: &quot;internal&quot; or &quot;external&quot;</li>
</ul>
<p>Optional arguments:</p>
<ul>
<li><code>format</code>: format of input for validation, e.g. &quot;R data frame&quot;</li>
<li><code>formatType</code>: type of object given to be used for validation. Defaults to &quot;text&quot; to perform text-matching of <code>format</code>s.</li>
</ul>
<p>Examples:</p>
<pre class="sourceCode r"><code class="sourceCode r">inp1 &lt;-<span class="st"> </span><span class="kw">moduleInput</span>(<span class="dt">name =</span> <span class="st">&quot;pollingBooths&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;internal&quot;</span>,
                    <span class="dt">format =</span> <span class="st">&quot;R data frame&quot;</span>)
inp2 &lt;-<span class="st"> </span><span class="kw">moduleInput</span>(<span class="dt">name =</span> <span class="st">&quot;boothLatLong&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;external&quot;</span>, 
                    <span class="dt">format =</span> <span class="st">&quot;CSV file&quot;</span>, <span class="dt">formatType =</span> <span class="st">&quot;text&quot;</span>)</code></pre>
<h4 id="moduleoutput"><code>moduleOutput()</code></h4>
<p>The <code>moduleOutput()</code> function is used to create the outputs for modules created in R with the <code>module()</code> function. Each &quot;internal&quot; output should correspond to an object of the same name in the module's source(s). &quot;external&quot; outputs are not produced by <em>conduit</em>, but are produced directly by the module source script(s). It is recommended that an &quot;external&quot; output have the same <code>name</code> and <code>ref</code>, though this is not compulsory. <code>moduleOutput()</code> requires the following arguments:</p>
<ul>
<li><code>name</code>: output name (must be unique within a module)</li>
<li><code>type</code>: &quot;internal&quot; or &quot;external&quot;
<ul>
<li><code>ref</code>: if the output <code>type</code> is &quot;external&quot; a <code>ref</code> must be provided. This provides the file location of the external output produced by the module source(s). This should be either a filename if the source(s) produce the file in the working direcory, or the full resource location of the external file. Relative file paths should not be used.</li>
</ul></li>
</ul>
<p>Optional arguments:</p>
<ul>
<li><code>format</code>: format of input for validation, e.g. &quot;R data frame&quot;</li>
<li><code>formatType</code>: type of object given to be used for validation. Defaults to &quot;text&quot; to perform text-matching of <code>format</code>s.</li>
</ul>
<p>Examples:</p>
<pre class="sourceCode r"><code class="sourceCode r">outp1 &lt;-<span class="st"> </span><span class="kw">moduleOutput</span>(<span class="dt">name =</span> <span class="st">&quot;pollingBooths&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;internal&quot;</span>,
                      <span class="dt">format =</span> <span class="st">&quot;R data frame&quot;</span>)
outp2 &lt;-<span class="st"> </span><span class="kw">moduleOutput</span>(<span class="dt">name =</span> <span class="st">&quot;boothCoords.csv&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;external&quot;</span>, 
                      <span class="dt">format =</span> <span class="st">&quot;CSV file&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;boothCoords.csv&quot;</span>)</code></pre>
<h4 id="modulesource"><code>moduleSource()</code></h4>
<p>The <code>moduleSource()</code> function creates source objects. These objects contain the scripts which are to be executed using a module's platform.</p>
<p>A source script can either be provided inline as a character vector, or as a reference to a script file.</p>
<p>Arguments:</p>
<ul>
<li><code>value</code>: a character vector containing the script to be executed. If <code>value</code> argument is empty, and a <code>ref</code> is provided, script will be read from the resource provided in <code>ref</code>.</li>
<li><code>ref</code>: Filename or file location of a text script file.
<ul>
<li><code>path</code>: optional search path(s) for <code>ref</code> resource</li>
</ul></li>
<li><code>type</code>: not used as at 2015-01-07.</li>
<li><code>order</code>: numeric value specifying the position of execution of this source in the module's sources. Module sources are executed in the following order:
<ol style="list-style-type: decimal">
<li>negative numbers in ascending order</li>
<li>0 (zero)</li>
<li>no order specified</li>
<li>positive numbers in ascending order</li>
</ol></li>
</ul>
<p>Examples:</p>
<pre class="sourceCode r"><code class="sourceCode r">script1 &lt;-<span class="st"> &quot;pollingPlaces &lt;- read.csv(file = csv_input)&quot;</span>
source1 &lt;-<span class="st"> </span><span class="kw">moduleSource</span>(<span class="dt">value =</span> script1)
source2 &lt;-<span class="st"> </span><span class="kw">moduleSource</span>(<span class="dt">ref =</span> <span class="st">&quot;plotting.R&quot;</span>, <span class="dt">path =</span> <span class="st">&quot;~/handyScripts&quot;</span>, 
                        <span class="dt">order =</span> <span class="st">&quot;-1&quot;</span>)</code></pre>
<h3 id="executing-module-scripts">Executing module scripts</h3>
<h4 id="runmodule"><code>runModule()</code></h4>
<p>Module source scripts are executed using the <code>runModule()</code> function. The function makes the module's inputs available to the source script(s) in the designated platform, and executes the source script(s). The module's outputs are saved to a directory called <code>modules</code>, in a subdirectory with the module's name. This function requires the following arguments:</p>
<ul>
<li><code>module</code>: a module object, usually from <code>module()</code> or <code>loadModule()</code></li>
<li><code>inputs</code>: a named list of absolute locations of module's inputs</li>
<li><code>targetDirectory</code>: file path for <code>modules</code> output directory</li>
</ul>
<p>Examples:</p>
<pre class="sourceCode r"><code class="sourceCode r">## run a module with no inputs
createGraphXML &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;createGraph.xml&quot;</span>)
createGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="dt">name =</span> <span class="st">&quot;createGraph&quot;</span>, <span class="dt">ref =</span> createGraphXML)
<span class="kw">runModule</span>(<span class="dt">module =</span> createGraph, <span class="dt">targetDirectory =</span> <span class="kw">getwd</span>())</code></pre>
<p>The module's output can be found at:</p>
<ul>
<li><a href="modules/createGraph/directedGraph.rds">directedGraph.rds</a></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">## run a module with an input
layoutGraphXML &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;layoutGraph.xml&quot;</span>)
layoutGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;layoutGraph&quot;</span>, layoutGraphXML)
## this module uses the output from the previous module as input
myGraph &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;modules&quot;</span>, <span class="st">&quot;createGraph&quot;</span>, <span class="st">&quot;directedGraph.rds&quot;</span>)
<span class="kw">runModule</span>(<span class="dt">module =</span> layoutGraph,
          <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="dt">myGraph =</span> <span class="kw">normalizePath</span>(myGraph)))</code></pre>
<h3 id="saving-modules-as-xml-files">Saving modules as XML files</h3>
<h4 id="savemodule"><code>saveModule()</code></h4>
<p>This function saves a module to disk as a module XML file. This function requires a <code>module</code> object be passed to the <code>module</code> argument. The function also accepts the following optional arguments:</p>
<ul>
<li><code>targetDirectory</code>: location to save XML file. This defaults to the current working directory.</li>
<li><code>filename</code>: name of resulting XML file. If not specified the file will be given the <code>module</code> name with '.xml' appended.</li>
</ul>
<p>The full path of the resulting file is returned.</p>
<p>Examples:</p>
<p>Specify the filename for the new module XML file:</p>
<pre class="sourceCode r"><code class="sourceCode r">createGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;createGraph&quot;</span>, 
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;createGraph.xml&quot;</span>))
tempTarget &lt;-<span class="st"> </span><span class="kw">tempdir</span>()
<span class="kw">saveModule</span>(<span class="dt">module =</span> createGraph, <span class="dt">targetDirectory =</span> tempTarget,
           <span class="dt">filename =</span> <span class="st">&quot;newCreateGraph.xml&quot;</span>)</code></pre>
<pre><code>## [1] &quot;/tmp/RtmpnXBEa8/newCreateGraph.xml&quot;</code></pre>
<p>Save a module to XML without specifiying the filename:</p>
<pre class="sourceCode r"><code class="sourceCode r">layoutGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;layoutGraph&quot;</span>, 
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;layoutGraph.xml&quot;</span>))
layoutGraph$name</code></pre>
<pre><code>## [1] &quot;layoutGraph&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveModule</span>(<span class="dt">module =</span> layoutGraph, <span class="dt">targetDirectory =</span> tempTarget)</code></pre>
<pre><code>## [1] &quot;/tmp/RtmpnXBEa8/layoutGraph.xml&quot;</code></pre>
<h2 id="pipelines">Pipelines</h2>
<p>This sections describes how to: load pipelines from XML files; create pipelines ; execute pipeline components; save pipelines and their components as XML files.</p>
<h3 id="loading-pipelines-from-xml">Loading pipelines from XML</h3>
<h4 id="loadpipeline"><code>loadPipeline()</code></h4>
<p>This function reads and interprets a pipeline XML file, producing a <code>pipeline</code> object in R. The function will also read and interpret module and pipeline XML provided in the XML's file <code>&lt;component&gt;</code> nodes. The resulting objects will be loaded into the <code>components</code> slot of the parent <code>pipeline</code> object. <code>loadPipeline()</code> requires the following arguments:</p>
<ul>
<li><code>name</code>: pipeline name</li>
<li><code>ref</code>: Filename or file path of XML file.
<ul>
<li><code>path</code>: optional search path(s) for <code>ref</code> resource</li>
</ul></li>
</ul>
<p><code>loadPipeline()</code> also accepts a <code>namespaces</code> argument, which should be a named character vector of namespaces used in the pipeline XML file. The default value for <code>namespaces</code> is <code>c(oa = &quot;http://www.openapi.org/2014/&quot;))</code>.</p>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span><span class="kw">loadPipeline</span>(<span class="dt">name =</span> <span class="st">&quot;simpleGraph&quot;</span>,
                            <span class="dt">ref =</span> <span class="kw">normalizePath</span>(
                                <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))</code></pre>
<h3 id="creating-pipelines">Creating pipelines</h3>
<p>Pipelines can be created using the <code>pipeline()</code> function, and its associated helper functions. The resulting <code>pipeline</code> objects can be executed using <em>conduit</em>, or saved to disk as XML files.</p>
<h4 id="pipeline"><code>pipeline()</code></h4>
<p>The <code>pipeline</code> function requires a <code>name</code> argument. The following arguments can also be provided:</p>
<ul>
<li><code>description</code>: A text description of what the pipeline does.</li>
<li><code>components</code>: a list of the pipelines components. These must be <code>module</code> or <code>pipeline</code> objects (or both). If this argument is empty the pipeline's components will be taken from the following arguments:
<ul>
<li><code>modules</code>: a list of <code>module</code> objects.</li>
<li><code>pipelines</code>: a list of <code>pipeline</code> objects.</li>
</ul></li>
<li><code>pipes</code>: a list of <code>pipe</code> objects.</li>
</ul>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">createGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;createGraph&quot;</span>, 
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;createGraph.xml&quot;</span>))
layoutGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;layoutGraph&quot;</span>,
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;layoutGraph.xml&quot;</span>))
pipe1 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;createGraph&quot;</span>, <span class="st">&quot;directedGraph&quot;</span>, <span class="st">&quot;layoutGraph&quot;</span>, <span class="st">&quot;myGraph&quot;</span>)
pipelineExample &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">pipeline</span>(<span class="dt">name =</span> <span class="st">&quot;example&quot;</span>, 
             <span class="dt">components =</span> <span class="kw">list</span>(createGraph, layoutGraph),
             <span class="dt">pipes =</span> <span class="kw">list</span>(pipe1))</code></pre>
<h4 id="addcomponent"><code>addComponent()</code></h4>
<p><code>addComponent</code> can be used to add a <code>module</code> or <code>pipeline</code> to the components of a <code>pipeline</code> created created with <code>pipeline()</code> or <code>loadPipeline()</code>.</p>
<p>Arguments:</p>
<ul>
<li><code>newComponent</code>: <code>module</code> or <code>pipeline</code> object to be added.</li>
<li><code>pipeline</code>: pipeline to be amended.</li>
</ul>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">testPipeline &lt;-<span class="st"> </span><span class="kw">pipeline</span>(<span class="st">&quot;test&quot;</span>)
plotGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;plotGraph&quot;</span>,
                        <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;plotGraph.xml&quot;</span>))
testPipeline &lt;-<span class="st"> </span><span class="kw">addComponent</span>(plotGraph, testPipeline)</code></pre>
<h4 id="pipe"><code>pipe()</code></h4>
<p>This function creates a <code>pipe</code> object, which connects the output of one pipeline component to the input of another pipeline component. The function requirtes four character vectors as arguments:</p>
<ul>
<li><code>startComponent</code>: name of the start component.</li>
<li><code>startOutput</code>: name of the required start component output.</li>
<li><code>endComponent</code>: name of the end component.</li>
<li><code>endInput</code>: name of the requrired end component input.</li>
</ul>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">pipe1 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="dt">startComponent =</span> <span class="st">&quot;createGraph&quot;</span>, <span class="dt">startOutput =</span> <span class="st">&quot;myGraph&quot;</span>,
              <span class="dt">endComponent =</span> <span class="st">&quot;layoutGraph&quot;</span>, <span class="dt">endInput =</span> <span class="st">&quot;directedGraph&quot;</span>)</code></pre>
<h4 id="addpipe"><code>addPipe()</code></h4>
<p><code>addPipe()</code> can be used to add a new pipe to an existing <code>pipeline</code> object.</p>
<p>Arguments:</p>
<ul>
<li><code>newPipe</code>: new <code>pipe</code> object.</li>
<li><code>pipeleine</code>: existing <code>pipeline</code> object.</li>
</ul>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">createGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;createGraph&quot;</span>, 
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;createGraph.xml&quot;</span>))
layoutGraph &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="st">&quot;layoutGraph&quot;</span>,
                          <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;layoutGraph.xml&quot;</span>))
pipelineExample &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">pipeline</span>(<span class="dt">name =</span> <span class="st">&quot;example&quot;</span>, 
             <span class="dt">components =</span> <span class="kw">list</span>(createGraph, layoutGraph))
## create new pipe
pipe1 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;createGraph&quot;</span>, <span class="st">&quot;directedGraph&quot;</span>, <span class="st">&quot;layoutGraph&quot;</span>, <span class="st">&quot;myGraph&quot;</span>)
## add pipe to pipeline
pipelineExample &lt;-<span class="st"> </span><span class="kw">addPipe</span>(pipe1, pipelineExample)</code></pre>
<h3 id="executing-pipeline-components">Executing pipeline components</h3>
<h4 id="runpipeline"><code>runPipeline()</code></h4>
<p>Pipeline can be executed using the <code>runPipeline()</code> function. The pipeline's components will be executed in an order which ensures each component's inputs will be satisfied. This function creates a directory called 'pipelines' in the current working directory. The output from a pipeline's components are saved in this diretory, in a sub-directory named after the pipeline.</p>
<p>This function has one argument, <code>pipeline</code>, which must be a pipeline object created using <code>pipeline()</code> or <code>loadPipeline()</code>.</p>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span><span class="kw">loadPipeline</span>(<span class="st">&quot;simpleGraph&quot;</span>,
                            <span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>))
<span class="kw">runPipeline</span>(simpleGraph)</code></pre>
<h4 id="runcomponent"><code>runComponent()</code></h4>
<p>Individual components in a pipeline can be executed using the <code>runComponent()</code> function. This can be useful for testing a pipeline. This function requires two arguments:</p>
<ul>
<li><code>componentName</code>: Name of component to be executed.</li>
<li><code>pipeline</code>: <code>pipeline</code> containing component.</li>
</ul>
<p>If the component is a module with one or more inputs, these massed be provided as a named list to the <code>inputs</code> argument.</p>
<p><code>runComponent()</code> will place component output in either a 'modules' or 'pipelines' directory, depending on the type of component. The location of this output directory can be specified using the <code>pipelinePath</code> argument.</p>
<p>Examples:</p>
<p>Running a component with no inputs:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">loadPipeline</span>(<span class="st">&quot;simpleGraph&quot;</span>,
                 <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))
<span class="kw">names</span>(simpleGraph$components)</code></pre>
<pre><code>## [1] &quot;plotGraph&quot;   &quot;createGraph&quot; &quot;layoutGraph&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">runComponent</span>(<span class="dt">componentName =</span> <span class="st">&quot;createGraph&quot;</span>, <span class="dt">pipeline =</span> simpleGraph)</code></pre>
<pre><code>## [1] 0</code></pre>
<p>The component's output can be found at:</p>
<ul>
<li><a href="modules/createGraph/directedGraph.rds">directedGraph.rds</a></li>
</ul>
<p>Running a component with one input:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">loadPipeline</span>(<span class="st">&quot;simpleGraph&quot;</span>,
                 <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))
<span class="kw">runComponent</span>(<span class="st">&quot;layoutGraph&quot;</span>, simpleGraph,
             <span class="dt">inputs =</span> 
                 <span class="kw">list</span>(<span class="dt">myGraph =</span>
                          <span class="kw">normalizePath</span>(
                              <span class="kw">file.path</span>(<span class="st">&quot;modules&quot;</span>, <span class="st">&quot;createGraph&quot;</span>,
                                        <span class="st">&quot;directedGraph.rds&quot;</span>))))</code></pre>
<pre><code>## [1] 0</code></pre>
<p>The component's output can be found at:</p>
<ul>
<li><a href="modules/createGraph/Ragraph.rds">Ragraph.rds</a></li>
</ul>
<h3 id="saving-and-exporting-pipelines-as-xml-files">Saving and exporting pipelines as XML files</h3>
<p>Pipelines created using can <code>pipeline()</code> and <code>loadPipeline()</code> can be saved to disk as XML files using the <code>savePipeline()</code> and <code>exportPipeline()</code> functions. <code>savePipeline()</code> will produce a single XML representing the pipeline; <code>exportPipeline()</code> will also create an XML file for each of the pipeline's components.</p>
<h4 id="savepipeline"><code>savePipeline()</code></h4>
<p>A pipeline can be saved to an XML file using <code>savePipeline()</code>. The <code>pipeline</code> argument must be provided with a <code>pipeline</code> object. The resulting xml file is always called <code>pipeline.xml</code>. The location of this file can be set using the <code>targetDirectory</code> argument.</p>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">loadPipeline</span>(<span class="st">&quot;simpleGraph&quot;</span>,
                 <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))
<span class="kw">savePipeline</span>(<span class="dt">pipeline =</span> simpleGraph, <span class="dt">targetDirectory =</span> <span class="st">&quot;savePipeline&quot;</span>)</code></pre>
<pre><code>## [1] &quot;savePipeline/pipeline.xml&quot;</code></pre>
<p>The resulting XML file can be found at:</p>
<ul>
<li><a href="savePipeline/pipeline.xml">pipeline.xml</a></li>
</ul>
<h4 id="exportpipeline"><code>exportPipeline()</code></h4>
<p><code>exportPipeline()</code> will save a pipeline to XML file, and save all its components to XML files, also. All the pipelines components will be given as references to the XML files created.</p>
<p>This function will save the XML files to a directory with pipeline's name, in the location specified in the argument <code>targetDirectory</code>.</p>
<p>Example:</p>
<pre class="sourceCode r"><code class="sourceCode r">simpleGraph &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">loadPipeline</span>(<span class="st">&quot;graphExport&quot;</span>,
                 <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;simpleGraph&quot;</span>, <span class="st">&quot;pipeline.xml&quot;</span>)))
<span class="kw">exportPipeline</span>(<span class="dt">pipeline =</span> simpleGraph, <span class="dt">targetDirectory =</span> <span class="st">&quot;exportPipeline&quot;</span>)</code></pre>
<pre><code>## $pipeline
## [1] &quot;exportPipeline/graphExport/pipeline.xml&quot;
## 
## $plotGraph
## [1] &quot;exportPipeline/graphExport/plotGraph.xml&quot;
## 
## $createGraph
## [1] &quot;exportPipeline/graphExport/createGraph.xml&quot;
## 
## $layoutGraph
## [1] &quot;exportPipeline/graphExport/layoutGraph.xml&quot;</code></pre>
<p>The resulting XML files can be found at:</p>
<ul>
<li><a href="exportPipeline/graphExport/pipeline.xml">pipeline.xml</a></li>
<li><a href="exportPipeline/graphExport/plotGraph.xml">plotGraph.xml</a></li>
<li><a href="exportPipeline/graphExport/createGraph.xml">createGraph.xml</a></li>
<li><a href="exportPipeline/graphExport/layoutGraph.xml">layoutGraph.xml</a></li>
</ul>
<h2 id="searching-for-files-in-conduit">Searching for files in <em>conduit</em></h2>
<p><em>conduit</em> allows the user to either specify the location of a resource file, or to provide a filename and file location(s) where the file should be found. Functions which have <code>ref</code> and <code>path</code> arguments provide the option to search for a resource.</p>
<p>If the value of <code>ref</code> is an absolute resource address, e.g. a full file path, then no further searching will be done. Relative file paths can also be provided to <code>ref</code> arguments. <span class="ann">TODO: provide precise definition explaining to which location a relative ref is relative.</span></p>
<p>If no resource can be sensibly found at <code>ref</code>, a search is started. <em>Conduit</em> will search by default in the directory for the module or pipeline which initiated the search, then R's current working directory. The default search paths can be amended or replaced by the <code>path</code> argument. Search paths are given as character strings, with each path divided by the '|' character. Values for <code>path</code> which end in '|' will be prepended to the default search paths, and those which beging with '|' will be appended.</p>
<p><em>conduit</em> will search in each search path provided until a matching file is located. The first match will be returned.</p>
<p>The following example will attemp to load a module by searching for a file named in <code>ref</code> in the paths listed in <code>path</code>, and then the default search paths.</p>
<pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">loadModule</span>(<span class="dt">name =</span> <span class="st">&quot;loader&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;arrangeLines.xml&quot;</span>,
                   <span class="dt">path =</span> <span class="st">&quot;~/openapi|/media/ashley/floppyDisk|&quot;</span>)</code></pre>
<h2 id="outputs-in-conduit">Outputs in <em>conduit</em></h2>
<p>When a module's source code is executed in <em>conduit</em> by the <a href="#runmodule"><code>runModule()</code></a> function, the module's outputs are saved to disk in a directory with the same name as the module.</p>
<p>Internal outputs are saved to disk by serializing objects in a file format relevant to the platform used. For example, imagine a module source script for the &quot;R&quot; platform creates an object, <code>finalData.df</code>. To mark this object as a module output the module must contain an internal output, named &quot;finalData.df&quot;. When the module's source script is executed <em>conduit</em> will produce a file named &quot;finalData.df.rds&quot; in the module's output directory; the file extension &quot;.rds&quot; is used for serializing R objects. Similarly, internal outputs from source scripts for the &quot;python&quot; platform will be serialized to a file with the file extension &quot;.pickle&quot;.</p>
<p>External outputs should be easy to identify, as they will be explicitly named in the module's source script.</p>
<h2 id="example-creating-a-pipeline-from-r-scripts">Example: creating a pipeline from R scripts</h2>
<p>In this example I will demonstrate how a pipeline can be created using R scripts for the modules' source scripts. We will create a pipeline called &quot;aucklandRents&quot; which reads in prices of flat listings for various Auckland suburbs and creates a boxplot comparison of three of those suburbs. Our first two modules will be 'dummy' modules, which load CSV files into <code>conduit</code>; one CSV file contains rental prices indexed by suburb, and the other contains a key for the suburb indices. The next module uses the suburb key to name the suburbs in the price listings, and produces an R data frame of this. This R data frame is cropped to the suburbs of interest in the next module, then the final module produces a boxplot of the rental prices for each suburb remaining.</p>
<p><span class="ann">TODO: make mention of packages used</span></p>
<h3 id="r-scripts">R scripts</h3>
<p>The R scripts for our example are as follows:</p>
<ul>
<li><a href="aucklandRents/src/nameSuburbs.R">nameSuburbs.R</a>:</li>
</ul>
<pre><code>## rentalListings &lt;- read.csv(rentalListings.csv, header = TRUE)
## suburbIDs &lt;- read.csv(suburbIDs.csv, header = TRUE, stringsAsFactors = FALSE)
## 
## namedListings &lt;- merge(x = rentalListings, y = suburbIDs,
##                        by.x = &quot;suburb&quot;, by.y = &quot;subIDs&quot;)</code></pre>
<ul>
<li><a href="aucklandRents/src/chooseSuburbs.R">chooseSuburbs.R</a>:</li>
</ul>
<pre><code>## ofInterest &lt;-
##     namedListings$subNames %in% c(&quot;Kingsland&quot;, &quot;Grey Lynn&quot;, &quot;Ponsonby&quot;)
## 
## shortListings &lt;- namedListings[ofInterest,]
## shortListings$subNames &lt;- factor(shortListings$subNames)</code></pre>
<ul>
<li><a href="aucklandRents/src/boxplotBySuburb.R">boxplotBySuburb.R</a>:</li>
</ul>
<pre><code>## svg(&quot;boxplot-rentBySuburb.svg&quot;)
## boxplot(listings$rent ~ listings$subNames, xlab = &quot;Suburb&quot;,
##         ylab = &quot;Rent per week ($)&quot;, main=&quot;Rental prices in Auckland&quot;)
## dev.off()</code></pre>
<p>R users will notice that the first script calls for files <code>rentalListings.csv</code> and <code>suburbIDs.csv</code> but that no such objects have been created. These object will be named as an inputs for this module, and will be made available to the module's R script by the glue system. Similarly the data frame <code>namedListings</code> will be named as an input for the second module, and <code>listings</code> as an input for the last module.</p>
<h3 id="getting-data-into-conduit-rentallistings-and-suburbids">Getting data into conduit: <code>rentalListings</code> and <code>suburbIDs</code></h3>
<p>This module needs to read data from two CSV files, <a href="aucklandRents/data/rentalListings.csv">rentalListings.csv</a> and <a href="aucklandRents/data/suburbIDs.csv">suburbIDs.csv</a>. For each CSV file we will create a dummy module which provides the file as an external output.</p>
<p>The <code>rentalListings</code> module will have one output, our first CSV file. External outputs for dummy modules require an absolute file path for <code>ref</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">rentalListingsOutput &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">moduleOutput</span>(<span class="dt">name =</span> <span class="st">&quot;rentalListings.csv&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;external&quot;</span>,
                 <span class="dt">format =</span> <span class="st">&quot;CSV file&quot;</span>,
                 <span class="dt">ref =</span> <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(<span class="st">&quot;aucklandRents&quot;</span>, <span class="st">&quot;data&quot;</span>,
                                               <span class="st">&quot;rentalListings.csv&quot;</span>)))</code></pre>
<p>We then create the <code>rentalListings</code> module as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">rentalListings &lt;-
<span class="st">    </span><span class="kw">module</span>(<span class="dt">name =</span> <span class="st">&quot;rentalListings&quot;</span>, <span class="dt">platform =</span> <span class="st">&quot;R&quot;</span>,
           <span class="dt">description =</span> <span class="st">&quot;load rentalListings.csv into session&quot;</span>,
           <span class="dt">outputs =</span> <span class="kw">list</span>(rentalListingsOutput))</code></pre>
<p>The <code>suburbIDs</code> module is created similarly:</p>
<pre class="sourceCode r"><code class="sourceCode r">suburbIDs &lt;-
<span class="st">    </span><span class="kw">module</span>(<span class="st">&quot;suburbIDs&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;load suburbIDs.csv into session&quot;</span>,
           <span class="dt">outputs =</span> <span class="kw">list</span>(
               <span class="kw">moduleOutput</span>(<span class="st">&quot;suburbIDs.csv&quot;</span>, <span class="st">&quot;external&quot;</span>, <span class="st">&quot;CSV file&quot;</span>,
                            <span class="dt">ref =</span> <span class="kw">normalizePath</span>(
                                <span class="kw">file.path</span>(<span class="st">&quot;aucklandRents&quot;</span>, <span class="st">&quot;data&quot;</span>,
                                          <span class="st">&quot;suburbIDs.csv&quot;</span>)))))</code></pre>
<h3 id="feeding-inputs-to-a-module-namesuburbs">Feeding inputs to a module: <code>nameSuburbs</code></h3>
<p>As mentioned above, our next module requires two CSV files &quot;suburbIDs.csv&quot; and &quot;rentalListings.csv&quot;. We will create two external inputs with these name which <code>conduit</code> will use to provide the module with its required inputs:</p>
<pre class="sourceCode r"><code class="sourceCode r">nameSuburbsInputs &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="kw">moduleInput</span>(<span class="dt">name =</span> <span class="st">&quot;rentalListings.csv&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;external&quot;</span>, 
                <span class="dt">format =</span> <span class="st">&quot;CSV file&quot;</span>),
    <span class="kw">moduleInput</span>(<span class="st">&quot;suburbIDs.csv&quot;</span>, <span class="st">&quot;external&quot;</span>, <span class="st">&quot;CSV file&quot;</span>))</code></pre>
<p>This module also has one source script, from the file <a href="aucklandRents/src/nameSuburbs.R">nameSuburbs.R</a>:</p>
<pre class="sourceCode r"><code class="sourceCode r">nameSuburbsSource &lt;-<span class="st"> </span><span class="kw">moduleSource</span>(<span class="dt">ref =</span> <span class="kw">file.path</span>(<span class="st">&quot;aucklandRents&quot;</span>, <span class="st">&quot;src&quot;</span>,
                                                  <span class="st">&quot;nameSuburbs.R&quot;</span>))</code></pre>
<p>The source script creates an 'R data frame' object, <code>namedListings</code>, which we will name as an internal output:</p>
<pre class="sourceCode r"><code class="sourceCode r">nameSuburbsOutput &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">moduleOutput</span>(<span class="st">&quot;namedListings&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R data frame&quot;</span>)</code></pre>
<p>Now we can create a module object, <code>nameSuburbs</code>, with the name &quot;nameSuburbs&quot;, a description, and the inputs, source and output created above:</p>
<pre class="sourceCode r"><code class="sourceCode r">nameSuburbs &lt;-
<span class="st">    </span><span class="kw">module</span>(<span class="dt">name =</span> <span class="st">&quot;nameSuburbs&quot;</span>, <span class="dt">platform =</span> <span class="st">&quot;R&quot;</span>,
           <span class="dt">description =</span> <span class="st">&quot;name suburbs in rentalListings.csv using key in suburbIDs.csv&quot;</span>,
           <span class="dt">inputs =</span> nameSuburbsInputs,
           <span class="dt">sources =</span> <span class="kw">list</span>(nameSuburbsSource),
           <span class="dt">outputs =</span> <span class="kw">list</span>(nameSuburbsOutput))</code></pre>
<h3 id="the-choosesuburbs-module">The <code>chooseSuburbs</code> module</h3>
<p>This module has one input, an 'R data frame' <code>namedListings</code>, and one source from the file <a href="aucklandRents/src/chooseSuburbs.R">chooseSuburbs.R</a>. This source produce an 'R data frame' <code>shortListings</code>, a smaller data frame of rental listings from three specific suburbs. We will name <code>shortListings</code> as an internal output:</p>
<pre class="sourceCode r"><code class="sourceCode r">chooseSuburbs &lt;-
<span class="st">    </span><span class="kw">module</span>(<span class="dt">name =</span> <span class="st">&quot;chooseSuburbs&quot;</span>, <span class="dt">platform =</span> <span class="st">&quot;R&quot;</span>,
           <span class="dt">description =</span> <span class="st">&quot;produces a data frame of rent prices for the named suburbs&quot;</span>,
           <span class="dt">inputs =</span> <span class="kw">list</span>(
               <span class="kw">moduleInput</span>(<span class="st">&quot;namedListings&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R data frame&quot;</span>)),
           <span class="dt">sources =</span> <span class="kw">list</span>(
               <span class="kw">moduleSource</span>(<span class="dt">ref =</span> <span class="kw">file.path</span>(<span class="st">&quot;aucklandRents&quot;</span>, <span class="st">&quot;src&quot;</span>, 
                                            <span class="st">&quot;chooseSuburbs.R&quot;</span>))),
           <span class="dt">outputs =</span> <span class="kw">list</span>(
               <span class="kw">moduleOutput</span>(<span class="st">&quot;shortListings&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R data frame&quot;</span>)))</code></pre>
<h3 id="the-last-module-boxplotbysuburb">The last module: <code>boxplotBySuburb</code></h3>
<p>The final script creates an SVG file, named &quot;boxplot-rentBySuburb.svg&quot;, in the current working directory. We will create an external output for this module, named &quot;boxplot-rentBySuburb.svg&quot;, and record the filename as the output's <code>ref</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">boxplotBySuburbOutput &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">moduleOutput</span>(<span class="dt">name =</span> <span class="st">&quot;boxplot-rentBySuburb.svg&quot;</span>,
                 <span class="dt">type =</span> <span class="st">&quot;external&quot;</span>,
                 <span class="dt">ref =</span> <span class="st">&quot;boxplot-rentBySuburb.svg&quot;</span>,
                 <span class="dt">format =</span> <span class="st">&quot;SVG image file&quot;</span>)</code></pre>
<p>This module has one source script, from the file <a href="aucklandRents/src/boxplotBySuburb.R">boxplotBySuburb.R</a>. This script requires an &quot;R data frame&quot; object, <code>listings</code>. We create the module <code>boxplotBySuburb</code> with the following code:</p>
<pre class="sourceCode r"><code class="sourceCode r">boxplotBySuburb &lt;-
<span class="st">    </span><span class="kw">module</span>(<span class="st">&quot;boxplotBySuburb&quot;</span>, <span class="dt">platform=</span><span class="st">&quot;R&quot;</span>,
           <span class="dt">inputs=</span><span class="kw">list</span>(
               <span class="kw">moduleInput</span>(<span class="st">&quot;listings&quot;</span>, <span class="st">&quot;internal&quot;</span>, <span class="st">&quot;R data frame&quot;</span>)),
           <span class="dt">sources=</span><span class="kw">list</span>(
               <span class="kw">moduleSource</span>(
                   <span class="dt">ref=</span><span class="kw">file.path</span>(<span class="st">&quot;aucklandRents&quot;</span>, <span class="st">&quot;src&quot;</span>, 
                                 <span class="st">&quot;boxplotBySuburb.R&quot;</span>))),
           <span class="dt">outputs=</span><span class="kw">list</span>(boxplotBySuburbOutput))</code></pre>
<h3 id="creating-pipes">Creating <code>pipe</code>s</h3>
<p>A pipeline consists of a set of components, and a set of pipes describing how component outputs are connected to other component inputs. The modules created above are our components; we will now create our pipes.</p>
<p>The dummy module <code>rentalListings</code> has an external output &quot;rentalListings.csv&quot;, a &quot;CSV file&quot;. We would like our pipeline to pas this output to the <code>nameSuburbs</code> module, which requires the &quot;CSV file&quot; external input &quot;rentalListings.csv&quot;`. The following code generates a pipe which makes this connection:</p>
<pre class="sourceCode r"><code class="sourceCode r">pipe1 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;rentalListings&quot;</span>, <span class="st">&quot;rentalListings.csv&quot;</span>,
              <span class="st">&quot;nameSuburbs&quot;</span>, <span class="st">&quot;rentalListings.csv&quot;</span>)</code></pre>
<p>Similarly, we need a pipe connecting &quot;suburbIDs.csv&quot; from <code>suburbIDs</code> to &quot;suburbIDs.csv&quot; in <code>nameSuburbs</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">pipe2 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;suburbIDs&quot;</span>, <span class="st">&quot;suburbIDs.csv&quot;</span>,
              <span class="st">&quot;nameSuburbs&quot;</span>, <span class="st">&quot;suburbIDs.csv&quot;</span>)</code></pre>
<p>Two more pipes are required, connecting &quot;namedListings&quot; from <code>nameSuburbs</code> to &quot;namedListings&quot; in <code>chooseSuburbs</code>, and connecting &quot;shortListings&quot; from <code>chooseSuburbs</code> to &quot;listings&quot; in <code>boxplotBySuburbs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">pipe3 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;nameSuburbs&quot;</span>, <span class="st">&quot;namedListings&quot;</span>,
              <span class="st">&quot;chooseSuburbs&quot;</span>, <span class="st">&quot;namedListings&quot;</span>)
pipe4 &lt;-<span class="st"> </span><span class="kw">pipe</span>(<span class="st">&quot;chooseSuburbs&quot;</span>, <span class="st">&quot;shortListings&quot;</span>,
              <span class="st">&quot;boxplotBySuburb&quot;</span>, <span class="st">&quot;listings&quot;</span>)</code></pre>
<h3 id="creating-the-aucklandrents-pipeline">Creating the <code>aucklandRents</code> pipeline</h3>
<p>We now have all the necessary pieces to create our <code>aucklandRents</code> pipeline. We have our list of components:</p>
<pre class="sourceCode r"><code class="sourceCode r">componentsList &lt;-<span class="st"> </span><span class="kw">list</span>(rentalListings, suburbIDs, nameSuburbs,
                       chooseSuburbs, boxplotBySuburb)</code></pre>
<p>and our list of pipes:</p>
<pre class="sourceCode r"><code class="sourceCode r">pipesList &lt;-<span class="st"> </span><span class="kw">list</span>(pipe1, pipe2, pipe3, pipe4)</code></pre>
<p>The following code creates our pipeline object:</p>
<pre class="sourceCode r"><code class="sourceCode r">aucklandRents &lt;-<span class="st"> </span><span class="kw">pipeline</span>(<span class="dt">name =</span> <span class="st">&quot;aucklandRents&quot;</span>,
                          <span class="dt">description =</span> <span class="st">&quot;&quot;</span>,
                          <span class="dt">components =</span> componentsList,
                          <span class="dt">pipes =</span> pipesList)</code></pre>
<h3 id="running-the-aucklandrents-pipeline">Running the <code>aucklandRents</code> pipeline</h3>
<p>Now we can run our pipeline:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">runPipeline</span>(aucklandRents)</code></pre>
<p>This creates the following files:</p>
<ol style="list-style-type: decimal">
<li><a href="pipelines/aucklandRents/modules/boxplotBySuburb/boxplot-rentBySuburb.svg" class="uri">pipelines/aucklandRents/modules/boxplotBySuburb/boxplot-rentBySuburb.svg</a></li>
<li><a href="pipelines/aucklandRents/modules/boxplotBySuburb/script.R" class="uri">pipelines/aucklandRents/modules/boxplotBySuburb/script.R</a></li>
<li><a href="pipelines/aucklandRents/modules/chooseSuburbs/script.R" class="uri">pipelines/aucklandRents/modules/chooseSuburbs/script.R</a></li>
<li><a href="pipelines/aucklandRents/modules/chooseSuburbs/shortListings.rds" class="uri">pipelines/aucklandRents/modules/chooseSuburbs/shortListings.rds</a></li>
<li><a href="pipelines/aucklandRents/modules/nameSuburbs/namedListings.rds" class="uri">pipelines/aucklandRents/modules/nameSuburbs/namedListings.rds</a></li>
<li><a href="pipelines/aucklandRents/modules/nameSuburbs/script.R" class="uri">pipelines/aucklandRents/modules/nameSuburbs/script.R</a></li>
<li><a href="pipelines/aucklandRents/modules/rentalListings/script.R" class="uri">pipelines/aucklandRents/modules/rentalListings/script.R</a></li>
<li><a href="pipelines/aucklandRents/modules/suburbIDs/script.R" class="uri">pipelines/aucklandRents/modules/suburbIDs/script.R</a></li>
</ol>
<p>File number 1, <a href="pipelines/aucklandRents/modules/boxplotBySuburb/boxplot-rentBySuburb.svg" class="uri">pipelines/aucklandRents/modules/boxplotBySuburb/boxplot-rentBySuburb.svg</a>, is the output file we require, the SVG image of the plot. The image is shown below:</p>
<div class="figure">
<img src="pipelines/aucklandRents/modules/boxplotBySuburb/boxplot-rentBySuburb.svg" alt="Pipeline output: aucklandRents plot" />
<p class="caption">Pipeline output: <code>aucklandRents</code> plot</p>
</div>
<h3 id="exporting-the-simplegraph-pipeline-to-xml">Exporting the <code>simpleGraph</code> pipeline to XML</h3>
<p>Our final step is to export the <code>aucklandRents</code> pipeline and its components to XML files so we can share them. The following code will create a directory with the same name as our pipeline, &quot;aucklandRents&quot;, and create XML files for the pipeline and each of its components in this directory. This is done with the following code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exportPipeline</span>(<span class="dt">pipeline =</span> aucklandRents,
               <span class="dt">targetDirectory =</span> <span class="kw">file.path</span>(<span class="kw">getwd</span>(), <span class="st">&quot;exportPipeline&quot;</span>))</code></pre>
<p>The resulting pipeline file, <a href="exportPipeline/aucklandRents/pipeline.xml" class="uri">exportPipeline/aucklandRents/pipeline.xml</a>, contains the following XML:</p>
<pre><code>## &lt;?xml version=&quot;1.0&quot;?&gt;
## &lt;pipeline xmlns=&quot;http://www.openapi.org/2014/&quot;&gt;
##   &lt;description&gt;&lt;/description&gt;
##   &lt;component name=&quot;rentalListings&quot; ref=&quot;rentalListings.xml&quot; type=&quot;module&quot;/&gt;
##   &lt;component name=&quot;suburbIDs&quot; ref=&quot;suburbIDs.xml&quot; type=&quot;module&quot;/&gt;
##   &lt;component name=&quot;nameSuburbs&quot; ref=&quot;nameSuburbs.xml&quot; type=&quot;module&quot;/&gt;
##   &lt;component name=&quot;chooseSuburbs&quot; ref=&quot;chooseSuburbs.xml&quot; type=&quot;module&quot;/&gt;
##   &lt;component name=&quot;boxplotBySuburb&quot; ref=&quot;boxplotBySuburb.xml&quot; type=&quot;module&quot;/&gt;
##   &lt;pipe&gt;
##     &lt;start component=&quot;rentalListings&quot; output=&quot;rentalListings.csv&quot;/&gt;
##     &lt;end component=&quot;nameSuburbs&quot; input=&quot;rentalListings.csv&quot;/&gt;
##   &lt;/pipe&gt;
##   &lt;pipe&gt;
##     &lt;start component=&quot;suburbIDs&quot; output=&quot;suburbIDs.csv&quot;/&gt;
##     &lt;end component=&quot;nameSuburbs&quot; input=&quot;suburbIDs.csv&quot;/&gt;
##   &lt;/pipe&gt;
##   &lt;pipe&gt;
##     &lt;start component=&quot;nameSuburbs&quot; output=&quot;namedListings&quot;/&gt;
##     &lt;end component=&quot;chooseSuburbs&quot; input=&quot;namedListings&quot;/&gt;
##   &lt;/pipe&gt;
##   &lt;pipe&gt;
##     &lt;start component=&quot;chooseSuburbs&quot; output=&quot;shortListings&quot;/&gt;
##     &lt;end component=&quot;boxplotBySuburb&quot; input=&quot;listings&quot;/&gt;
##   &lt;/pipe&gt;
## &lt;/pipeline&gt;</code></pre>
<p>The component XML files can be seen at:</p>
<ul>
<li><a href="exportPipeline/aucklandRents/boxplotBySuburb.xml" class="uri">exportPipeline/aucklandRents/boxplotBySuburb.xml</a></li>
<li><a href="exportPipeline/aucklandRents/chooseSuburbs.xml" class="uri">exportPipeline/aucklandRents/chooseSuburbs.xml</a></li>
<li><a href="exportPipeline/aucklandRents/nameSuburbs.xml" class="uri">exportPipeline/aucklandRents/nameSuburbs.xml</a></li>
<li><a href="exportPipeline/aucklandRents/rentalListings.xml" class="uri">exportPipeline/aucklandRents/rentalListings.xml</a></li>
<li><a href="exportPipeline/aucklandRents/suburbIDs.xml" class="uri">exportPipeline/aucklandRents/suburbIDs.xml</a></li>
</ul>
<p>Spotters will notice that the external output <code>ref</code>s in rentalListings.xml and suburbIDs.xml refer to absolute paths on the author's machine; to run this pipeline these will need to be edited to reflect local locations of these data files. A mechanism for exporting data sources has not yet been written into <code>conduit</code>.</p>
<h2 id="example-combining-r-and-python-scripts">Example: combining R and python scripts</h2>
<p><span class="ann">TODO: write an example combining R and python scripts</span></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Guide to using <em>conduit</em></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://canadia.co.nz/" property="cc:attributionName" rel="cc:attributionURL">Ashley Noel Hinton</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
<hr />
<div class="references">
<h2 id="references" class="unnumbered">References</h2>
<p>Carey, Vince, Li Long, and R. Gentleman. <em>RBGL: An Interface to the BOOST Graph Library</em>. <a href="http://www.bioconductor.org" class="uri">http://www.bioconductor.org</a>.</p>
<p>Gentleman, R., Elizabeth Whalen, W. Huber, and S. Falcon. <em>Graph: Graph: A Package to Handle Graph Data Structures</em>.</p>
<p>Hansen, Kasper Daniel, Jeff Gentry, Li Long, Robert Gentleman, Seth Falcon, Florian Hahne, and Deepayan Sarkar. <em>Rgraphviz: Provides Plotting Capabilities for R Graph Objects</em>.</p>
<p>Hinton, Ashley Noel, and Paul Murrell. 2014. <em>Conduit: Prototype Glue System for Openapi</em>.</p>
<p>———. 2015. <em>Introducing Openapi</em>. 2015-01. <em>Stat Tech: Statistics Technical Blog</em>. Auckland, New Zealand: Department of Statistics, University of Auckland. <a href="http://stattech.wordpress.fos.auckland.ac.nz/" class="uri">http://stattech.wordpress.fos.auckland.ac.nz/</a>.</p>
<p>Lang, Duncan Temple. 2013. <em>XML: Tools for Parsing and Generating XML Within R and S-Plus.</em> <a href="http://CRAN.R-project.org/package=XML" class="uri">http://CRAN.R-project.org/package=XML</a>.</p>
<p>———. 2014. <em>RCurl: General Network (HTTP/FTP/.) Client Interface for R</em>. <a href="http://CRAN.R-project.org/package=RCurl" class="uri">http://CRAN.R-project.org/package=RCurl</a>.</p>
<p>Murrell, Paul, and Ashley Noel Hinton. 2014. <em>GridGraphviz: Drawing Graphs with Grid</em>. <a href="http://R-Forge.R-project.org/projects/gridgraph/" class="uri">http://R-Forge.R-project.org/projects/gridgraph/</a>.</p>
<p>R Core Team. 2014. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org/" class="uri">http://www.R-project.org/</a>.</p>
<p>Wickham, Hadley, and Winston Chang. 2014. <em>Devtools: Tools to Make Developing R Code Easier</em>. <a href="http://CRAN.R-project.org/package=devtools" class="uri">http://CRAN.R-project.org/package=devtools</a>.</p>
</div>
</div>
</body>
</html>
